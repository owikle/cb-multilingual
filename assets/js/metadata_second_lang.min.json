---
# metadata for table ajax, using second language
---
{%- assign items = site.data[site.metadata] -%}
{%- assign fields = site.data.grand-config-metadata -%}
{%- assign table-fields = site.data.config-table | map: 'field-id' -%}
{%- assign firstLang = site.site_languages[0].lang_id | prepend: 'field-' -%}
{%- assign secondLang = site.site_languages[1].lang_id | prepend: 'field-' -%}
{ "objects": [
{% for item in items %}[ 
    {%- for f in fields -%}
    {%- assign firstLangField = f[firstLang] -%}
    {%- assign secondLangField = f[secondLang] -%}
        {%- for t in table-fields -%}
            {%- if f.field-id == t -%}
            {% if item[secondLangField] %}{{ item[secondLangField] | jsonify }}{% elsif item[firstLangField] %}{{ item[firstLangField] | jsonify }}{% else %}"n/a"{% endif %},
            {%- endif -%} 
        {%- endfor -%}
    {%- endfor -%}
    {{ '/item.html' | relative_url | append: '?id=' | append: item.objectid | jsonify }} ]{% unless forloop.last %},{% endunless %}
{% endfor %}
] }